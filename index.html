<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Customer Project Intake Form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <style>
    :root{
      --orange:#ff6a00;
      --navy:#0b1a2b;
      --border:#dfe3eb;
      --muted:#6b7280;
      --text:#0f172a;
      --radius:8px;
      --font:"Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      --section-bg:#f7f8fb; /* light grey section bar */
      --section-border:#e5e8f0;
    }
    *{ box-sizing:border-box; }
    body{ margin:0; color:var(--text); font-family:var(--font); background:#fff; }
    main{ max-width:1000px; margin:20px auto 48px; padding:0 14px; }

    /* Header with right-aligned logo at the very top */
    .topbar{ display:flex; align-items:flex-start; justify-content:space-between; gap:12px; }
    h1{ margin:0 0 6px; font-size:26px; }
    .subtitle{ color:#374151; margin:0 0 12px; font-weight:600; }
    .logo img{ max-width:130px; height:auto; display:block; }
    .note{ color:#475569; margin:8px 0 18px; }

    /* Section title: full-width light-grey bar with orange text (aligns with tables) */
    .section-bar{
      width:100%;
      background:var(--section-bg);
      border:1px solid var(--section-border);
      color:var(--orange);
      font-weight:700;
      padding:10px 12px;
      border-radius:var(--radius);
      margin:18px 0 10px;
    }

    /* Three-column tables */
    table{ width:100%; border-collapse:separate; border-spacing:0; margin-bottom:16px; }
    thead th{
      background:var(--navy); color:#fff;
      padding:12px 10px; font-weight:700;
      border-right:1px solid rgba(255,255,255,.12);
      text-align:left;                /* header left-aligned */
      vertical-align:middle;          /* header vertically centered */
    }
    thead th:last-child{ border-right:none; }
    tbody td{
      border:1px solid var(--border); border-top:none;
      padding:10px; background:#fff;
      vertical-align:middle;          /* cells vertically centered */
    }

    /* ⬇️ Style rule requested:
       left-align & vertical-center for Description + Capacity / Unit columns */
    /* Description column (1st col) */
    tbody td:nth-child(1){ text-align:left; }
    thead th:nth-child(1){ text-align:left; }
    /* Capacity / Unit column (2nd col) */
    tbody td:nth-child(2){ text-align:left; }
    thead th:nth-child(2){ text-align:left; }

    /* Customer to Populate column can remain default (inputs fill width) */
    .unit{ white-space:nowrap; width:220px; color:#64748b; }

    /* Inputs */
    input[type="text"], input[type="email"], input[type="date"], select, textarea{
      width:100%; padding:8px 10px; border:1px solid #cbd5e1; border-radius:8px; font-size:14px;
      outline:none; background:#fff;
    }
    input:focus, select:focus, textarea:focus{ border-color:#2563eb; box-shadow:0 0 0 3px rgba(37,99,235,.15); }
    textarea{ resize:vertical; min-height:80px; }
    .muted{ color:var(--muted); font-size:12px; margin-top:6px; }
    .req::after{ content:" *"; color:var(--orange); font-weight:700; }
    .invalid{ border-color:#ef4444 !important; box-shadow:0 0 0 2px rgba(239,68,68,.12); }

    /* Actions & status */
    .actions{ display:flex; gap:12px; align-items:center; margin-top:12px; }
    button{
      background:var(--orange); color:#fff; border:none; padding:10px 14px; border-radius:8px;
      font-weight:700; cursor:pointer;
    }
    button[disabled]{ opacity:.7; cursor:not-allowed; }
    #submit-status{ white-space:pre-wrap; }
    .ok{ color:#0b7a37; }
    .err{ color:#b00020; }

    footer{ color:#64748b; font-size:12px; margin-top:24px; }
  </style>
</head>
<body>
  <main>
    <div class="topbar">
      <div>
        <h1>Customer Project Intake Form</h1>
        <div class="subtitle">Renewables • Thermal</div>
      </div>
      <div class="logo">
        <img src="https://seekvectorlogo.com/wp-content/uploads/2019/05/aggreko-vector-logo.png" alt="Aggreko logo" />
      </div>
    </div>
    <div class="note">Note: Please complete all applicable sections. If a field does not apply to your project, feel free to leave it blank.</div>

    <form id="customer-intake-form" novalidate>
      <!-- ============== Customer Details ============== -->
      <div class="section-bar">Customer Details</div>
      <table>
        <thead>
          <tr>
            <th>Description</th>
            <th class="unit">Capacity / Unit</th>
            <th>Customer to Populate</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><span class="req">Customer company</span></td>
            <td class="unit">–</td>
            <td><input type="text" id="customerCompany" name="customerCompany" required aria-required="true" placeholder="Company name" /></td>
          </tr>
          <tr>
            <td><span class="req">Primary contact name</span></td>
            <td class="unit">–</td>
            <td><input type="text" id="contactName" name="contactName" required aria-required="true" placeholder="Full name" /></td>
          </tr>
          <tr>
            <td><span class="req">Email</span></td>
            <td class="unit">–</td>
            <td><input type="email" id="contactEmail" name="contactEmail" required aria-required="true" placeholder="name@company.com" /></td>
          </tr>
        </tbody>
      </table>

      <!-- ============== Project, Site & Contract ============== -->
      <div class="section-bar">Project, Site &amp; Contract</div>
      <table>
        <thead>
          <tr>
            <th>Description</th>
            <th class="unit">Capacity / Unit</th>
            <th>Customer to Populate</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><span class="req">Site</span></td>
            <td class="unit">Name &amp; Location</td>
            <td>
              <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px;">
                <input type="text" id="siteName" name="siteName" required aria-required="true" placeholder="Site / Project name" />
                <input type="text" id="siteLocation" name="siteLocation" required aria-required="true" placeholder="Town/Region, State/Territory" />
              </div>
            </td>
          </tr>
          <tr>
            <td><span class="req">Contract Term</span></td>
            <td class="unit">Years</td>
            <td><input type="text" id="contractTerm" name="contractTerm" required aria-required="true" placeholder="e.g., 10 or TBC" /></td>
          </tr>
          <tr>
            <td>Contract Term Extension</td>
            <td class="unit">Years</td>
            <td><input type="text" id="contractExtension" name="contractExtension" placeholder="e.g., 5 or TBC" /></td>
          </tr>
          <tr>
            <td><span class="req">Target COD Date</span></td>
            <td class="unit">DD/MM/YYYY</td>
            <td><input type="date" id="targetCOD" name="targetCOD" required aria-required="true" /></td>
          </tr>
        </tbody>
      </table>

      <!-- ============== Power & Energy ============== -->
      <div class="section-bar">Power &amp; Energy</div>
      <table>
        <thead>
          <tr>
            <th>Description</th>
            <th class="unit">Capacity / Unit</th>
            <th>Customer to Populate</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><span class="req">CMD (Contracted Maximum Demand)</span></td>
            <td class="unit">MW</td>
            <td><input type="text" id="cmdMW" name="cmdMW" required aria-required="true" placeholder="e.g., 20 or TBC" /></td>
          </tr>
          <tr>
            <td><span class="req">Redundancy</span></td>
            <td class="unit">N+1 or N+2</td>
            <td>
              <select id="redundancy" name="redundancy" required aria-required="true">
                <option value="">Select…</option>
                <option>N+1</option>
                <option>N+2</option>
                <option>Other</option>
              </select>
            </td>
          </tr>
          <tr>
            <td>Average Demand</td>
            <td class="unit">MW</td>
            <td><input type="text" id="avgDemandMW" name="avgDemandMW" placeholder="e.g., 12 or TBC" /></td>
          </tr>
          <tr>
            <td><span class="req">Fuel Type</span></td>
            <td class="unit">Type</td>
            <td>
              <select id="fuelType" name="fuelType" required aria-required="true">
                <option value="">Select fuel…</option>
                <option>Diesel</option>
                <option>Gas</option>
                <option>LNG</option>
                <option>Other</option>
              </select>
            </td>
          </tr>
          <tr>
            <td>Assumed Fuel Price</td>
            <td class="unit">$/L or $/GJ</td>
            <td><input type="text" id="fuelPrice" name="fuelPrice" placeholder="e.g., 1.28 or TBC" /></td>
          </tr>
          <tr>
            <td>Fuel Facility</td>
            <td class="unit">Description / Delivered?</td>
            <td><input type="text" id="fuelFacility" name="fuelFacility" placeholder="e.g., Onsite tanks, delivered fuel" /></td>
          </tr>
          <tr>
            <td><span class="req">Land Availability</span></td>
            <td class="unit">Area + Status</td>
            <td><input type="text" id="landAvailability" name="landAvailability" required aria-required="true" placeholder="e.g., 5 ha / In principle" /></td>
          </tr>
          <tr>
            <td><span class="req">Maximum Temperature</span></td>
            <td class="unit">°C</td>
            <td><input type="text" id="maxTemp" name="maxTemp" required aria-required="true" placeholder="e.g., 46 or TBC" /></td>
          </tr>
        </tbody>
      </table>

      <!-- ============== Renewables ============== -->
      <div class="section-bar">Renewables</div>
      <table>
        <thead>
          <tr>
            <th>Description</th>
            <th class="unit">Capacity / Unit</th>
            <th>Customer to Populate</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>Wind</td>
            <td class="unit">Capacity (MWp)</td>
            <td>
              <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px;">
                <select id="wind" name="wind">
                  <option value="">Select…</option>
                  <option>Optimised</option>
                  <option>Will specify</option>
                  <option>Not applicable</option>
                </select>
                <input type="text" id="windCapacityMWp" name="windCapacityMWp" placeholder="Capacity (MWp)" />
              </div>
            </td>
          </tr>
          <tr>
            <td>Solar PV</td>
            <td class="unit">Capacity (MWp)</td>
            <td>
              <div style="display:grid; grid-template-columns:1fr 1fr; gap:8px;">
                <select id="solarPV" name="solarPV">
                  <option value="">Select…</option>
                  <option>Optimised</option>
                  <option>Will specify</option>
                  <option>Not applicable</option>
                </select>
                <input type="text" id="solarCapacityMWp" name="solarCapacityMWp" placeholder="Capacity (MWp)" />
              </div>
            </td>
          </tr>
          <tr>
            <td>Battery Energy Storage (BESS)</td>
            <td class="unit">–</td>
            <td>
              <select id="bess" name="bess">
                <option value="">Select…</option>
                <option>Optimised</option>
                <option>Yes</option>
                <option>No</option>
                <option>Considering</option>
              </select>
            </td>
          </tr>
          <tr>
            <td>Renewable Energy Fraction (REF%)</td>
            <td class="unit">%</td>
            <td><input type="text" id="refPercent" name="refPercent" placeholder="e.g., 45 or TBC" /></td>
          </tr>
        </tbody>
      </table>

      <!-- ============== Additional Project Details ============== -->
      <div class="section-bar">Additional Project Details</div>
      <textarea id="notes" name="notes" placeholder="Any additional context, timelines, or constraints…"></textarea>

      <div class="actions">
        <button type="submit" id="submitBtn">Submit Form</button>
        <div id="submit-status" role="status" aria-live="polite"></div>
      </div>

      <footer>
        <p><strong>Privacy &amp; Confidentiality.</strong> Information you provide will be used to assess project requirements and budgetary pricing and may be stored in Aggreko systems in accordance with Aggreko’s privacy practices. © Aggreko.</p>
      </footer>
    </form>
  </main>

  <script>
    // ===== FLOW URL (use & characters, not &amp;) =====
    const FLOW_URL =
      "https://default5cb01ea241604f87afc65e72e6b82a.d1.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/0f422bbcb71f4f06a6e42ee74aa5b776/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=uoPMJp8FLgPGZgu_yZtEchRN65A-105UHltuzQnn_Ko";

    // Helpers
    function numOrText(v){
      const s = (v ?? "").toString().trim();
      if (!s) return "";
      const n = Number(s.replace(/,/g,""));
      return Number.isFinite(n) ? n : s; // keep "TBC", etc.
    }
    function text(v){ return (v ?? "").toString().trim(); }
    function dateDDMMYYYY(yyyy_mm_dd){
      if(!yyyy_mm_dd) return "";
      const [y,m,d] = yyyy_mm_dd.split("-");
      if(!y||!m||!d) return yyyy_mm_dd;
      return `${d}/${m}/${y}`;
    }
    function setStatus(msg, ok=true){
      const el = document.getElementById("submit-status");
      el.textContent = msg;
      el.className = ok ? "ok" : "err";
    }

    // Required validation (same set as you specified)
    function validateRequired(){
      const ids = [
        "customerCompany","contactName","contactEmail",
        "siteName","siteLocation",
        "contractTerm",
        "targetCOD",
        "cmdMW",
        "redundancy",
        "fuelType",
        "landAvailability",
        "maxTemp"
      ];
      let first=null, missing=[];
      const label = {
        customerCompany:"Customer company",
        contactName:"Primary contact name",
        contactEmail:"Email",
        siteName:"Site name",
        siteLocation:"Site location",
        contractTerm:"Contract term",
        targetCOD:"Target COD date",
        cmdMW:"CMD (MW)",
        redundancy:"Redundancy",
        fuelType:"Fuel type",
        landAvailability:"Land availability",
        maxTemp:"Maximum temperature (°C)"
      };
      ids.forEach(id=>{
        const el = document.getElementById(id);
        const val = (el?.value ?? "").toString().trim();
        const invalid = (el?.tagName==="SELECT") ? (val==="") : (val.length===0);
        if(invalid){ el?.classList.add("invalid"); missing.push(label[id]||id); if(!first) first = el; }
        else el?.classList.remove("invalid");
      });
      if(missing.length){
        setStatus("Please complete the required fields:\n• " + missing.join("\n• "), false);
        first?.focus();
        return false;
      }
      setStatus(""); // clear
      return true;
    }

    // Submit (unchanged logic/payload)
    document.getElementById("customer-intake-form").addEventListener("submit", async (e)=>{
      e.preventDefault();
      if (!validateRequired()) return;

      setStatus("Submitting…", true);
      const btn = document.getElementById("submitBtn");
      btn.disabled = true;

      const payload = {
        // ===== EXACT Excel column names =====
        customerCompany: text(document.getElementById("customerCompany").value),
        contactName: text(document.getElementById("contactName").value),
        contactEmail: text(document.getElementById("contactEmail").value),

        siteName: text(document.getElementById("siteName").value),
        siteLocation: text(document.getElementById("siteLocation").value),

        contractTerm: text(document.getElementById("contractTerm").value),
        contractExtension: text(document.getElementById("contractExtension").value),
        targetCOD: dateDDMMYYYY(document.getElementById("targetCOD").value),

        cmdMW: numOrText(document.getElementById("cmdMW").value),
        redundancy: text(document.getElementById("redundancy").value),
        avgDemandMW: numOrText(document.getElementById("avgDemandMW").value),

        wind: text(document.getElementById("wind").value),
        windCapacityMWp: numOrText(document.getElementById("windCapacityMWp").value),
        solarPV: text(document.getElementById("solarPV").value),
        solarCapacityMWp: numOrText(document.getElementById("solarCapacityMWp").value),
        bess: text(document.getElementById("bess").value),
        refPercent: numOrText(document.getElementById("refPercent").value),

        fuelType: text(document.getElementById("fuelType").value),
        fuelPrice: numOrText(document.getElementById("fuelPrice").value),
        fuelFacility: text(document.getElementById("fuelFacility").value),

        landAvailability: text(document.getElementById("landAvailability").value),
        maxTemp: numOrText(document.getElementById("maxTemp").value)
      };

      try{
        const res = await fetch(FLOW_URL, {
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify(payload)
        });

        const textRes = await res.text();
        let data; try{ data = JSON.parse(textRes); } catch{ data = null; }

        if(!res.ok){
          const msg = (data && (data.message || data.error)) || textRes || (`HTTP ${res.status}`);
          throw new Error(msg);
        }

        const okMsg = (data && (data.message || "Row added successfully")) || "Row added successfully";
        setStatus(okMsg, true);
        e.target.reset();
      } catch(err){
        console.error(err);
        setStatus("Submission failed: " + (err?.message || String(err)), false);
      } finally {
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>
