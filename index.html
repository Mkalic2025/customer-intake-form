<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Customer Intake Form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />

  <style>
    :root{
      --brand:#ff6a00; /* Aggreko orange feel */
      --brand-dark:#d45500;
      --bg:#f6f7f9;
      --text:#1f2937;
      --muted:#6b7280;
      --ok:#0b7a37;
      --err:#b00020;
      --card:#ffffff;
      --border:#e5e7eb;
      --focus:#2563eb;
      --font: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body{
      margin:0;
      font-family: var(--font);
      color: var(--text);
      background: linear-gradient(180deg, var(--bg), #ffffff);
    }
    header{
      padding: 24px 16px;
      background:#101828;
      color:#fff;
      border-bottom: 4px solid var(--brand);
    }
    .wrap{
      max-width: 880px;
      margin: 24px auto 48px auto;
      padding: 0 16px;
    }
    h1{ margin: 0; font-size: clamp(20px, 2.6vw, 28px); line-height: 1.2; }
    p.sub{ color:#cbd5e1; margin-top:8px; margin-bottom:0; }

    .card{
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 6px 20px rgba(16,24,40,.06);
    }

    fieldset{ border: none; padding: 0; margin: 0 0 16px 0; }
    .row{ display: grid; grid-template-columns: 1fr; gap: 16px; }
    @media(min-width: 720px){
      .row-2 { grid-template-columns: 1fr 1fr; }
      .row-3 { grid-template-columns: 1fr 1fr 1fr; }
    }

    label{ display:inline-block; font-weight: 600; margin-bottom: 6px; }
    .req::after{ content:" *"; color: var(--brand); font-weight: 700; }

    input[type="text"],
    input[type="number"],
    input[type="email"],
    textarea,
    select{
      width: 100%;
      padding: 12px 14px;
      border: 1px solid var(--border);
      border-radius: 10px;
      background: #fff;
      font-size: 15px;
      color: var(--text);
      outline: none;
      transition: border-color .15s ease, box-shadow .15s ease;
    }
    input::placeholder, textarea::placeholder { color: #9ca3af; }
    input:focus, textarea:focus, select:focus{
      border-color: var(--focus);
      box-shadow: 0 0 0 3px rgba(37,99,235,.15);
    }
    .help{ font-size: 12px; color: var(--muted); margin-top: 6px; }

    .actions{ display:flex; gap:12px; align-items:center; margin-top:8px; }
    button{
      background: var(--brand);
      color:#fff;
      font-weight:700;
      border:none;
      padding:12px 18px;
      border-radius:10px;
      cursor:pointer;
      transition: background .15s ease, transform .02s ease;
    }
    button:hover{ background: var(--brand-dark); }
    button:active{ transform: translateY(1px); }
    .btn-secondary{ background:#eef2ff; color:#1e40af; }

    .status{
      margin-top:12px; padding:10px 12px; border-radius:10px;
      display:none; border:1px solid transparent; line-height:1.35; white-space:pre-wrap;
    }
    .status.show{ display:block; }
    .status.ok{ color:var(--ok); background:#ecfdf3; border-color:#a7f3d0; }
    .status.err{ color:var(--err); background:#ffefef; border-color:#ffc9c9; }

    footer{ color:var(--muted); text-align:center; font-size:12px; padding:16px; }

    /* Honeypot to reduce spam */
    .hp{ position:absolute !important; left:-99999px !important; width:1px; height:1px; overflow:hidden; }
  </style>
</head>
<body>
  <header>
    <div class="wrap">
      <h1>Customer Intake Form</h1>
      <p class="sub">Provide minimum details to register a site opportunity. Fields with * are required. “TBC” is allowed when values are unknown.</p>
    </div>
  </header>

  <main class="wrap">
    <section class="card">
      <form id="customer-intake-form" novalidate>
        <!-- Required -->
        <fieldset class="row row-2">
          <div>
            <label for="siteName" class="req">Site Name</label>
            <input id="siteName" name="siteName" type="text" placeholder="e.g., Finniss Power Station" required />
            <div class="help">Project or facility name.</div>
          </div>
          <div>
            <label for="location" class="req">Location</label>
            <input id="location" name="location" type="text" placeholder="e.g., NT, Australia" required />
            <div class="help">Town/region + state/territory/country.</div>
          </div>
        </fieldset>

        <!-- Contract & Fuel -->
        <fieldset class="row row-3">
          <div>
            <label for="contractTermYears">Contract Term (Years)</label>
            <input id="contractTermYears" name="contractTermYears" type="text" inputmode="decimal" placeholder="e.g., 10 or TBC" />
            <div class="help">Enter a number or “TBC”.</div>
          </div>
          <div>
            <label for="fuelType" class="req">Fuel Type</label>
            <input id="fuelType" name="fuelType" type="text" placeholder="e.g., diesel, gas, HVO" required />
          </div>
          <div>
            <label for="fuelPrice">Assumed Fuel Price</label>
            <input id="fuelPrice" name="fuelPrice" type="text" inputmode="decimal" placeholder="e.g., 1.28 or TBC" />
          </div>
        </fieldset>

        <!-- Land & Climate -->
        <fieldset class="row row-2">
          <div>
            <label for="landAvailability">Land Availability (Area + Status)</label>
            <input id="landAvailability" name="landAvailability" type="text" placeholder="e.g., 5 ha available, easement TBC" />
          </div>
          <div>
            <label for="maxTemperatureC">Maximum Temperature (°C)</label>
            <input id="maxTemperatureC" name="maxTemperatureC" type="text" inputmode="decimal" placeholder="e.g., 46 or TBC" />
          </div>
        </fieldset>

        <!-- Optional contact -->
        <fieldset class="row row-2">
          <div>
            <label for="contactName">Contact Name</label>
            <input id="contactName" name="contactName" type="text" placeholder="e.g., John Smith" />
          </div>
          <div>
            <label for="contactEmail">Contact Email</label>
            <input id="contactEmail" name="contactEmail" type="email" placeholder="e.g., name@company.com" />
          </div>
        </fieldset>

        <fieldset>
          <label for="notes">Notes</label>
          <textarea id="notes" name="notes" rows="4" placeholder="Any additional context, timelines, or constraints…"></textarea>
        </fieldset>

        <!-- Honeypot -->
        <div class="hp" aria-hidden="true">
          <label for="company">Company</label>
          <input id="company" name="company" type="text" tabindex="-1" autocomplete="off" />
        </div>

        <div class="actions">
          <button type="submit" id="submitBtn">Submit</button>
          <button type="reset" class="btn-secondary">Reset</button>
        </div>
        <div id="submit-status" class="status" role="status" aria-live="polite"></div>
      </form>
    </section>

    <footer>
      <p>Powered by Microsoft Power Automate HTTP Request trigger — GitHub Pages</p>
    </footer>
  </main>

  <script>
    // ===== CONFIG =====
    // IMPORTANT: real & characters (NOT &amp;) in the URL.
    const FLOW_URL = "https://default5cb01ea241604f87afc65e72e6b82a.d1.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/0f422bbcb71f4f06a6e42ee74aa5b776/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=uoPMJp8FLgPGZgu_yZtEchRN65A-105UHltuzQnn_Ko";

    // Optional shared token; set a header check in the Flow if you use this.
    const SHARED_FORM_TOKEN = "";

    // ===== UTIL =====
    function sanitizeTBC(value) {
      const v = (value ?? "").trim();
      if (!v) return "TBC";
      const n = Number(v);
      return Number.isFinite(n) ? n : v; // number if numeric, else string (e.g., "TBC")
    }
    function setStatus(msg, ok=true){
      const el = document.getElementById("submit-status");
      el.textContent = msg;
      el.className = "status show " + (ok ? "ok" : "err");
    }
    function clearStatus(){
      const el = document.getElementById("submit-status");
      el.textContent = "";
      el.className = "status";
    }
    function validateRequired(ids){
      let first = null;
      for (const id of ids){
        const input = document.getElementById(id);
        const val = (input.value || "").trim();
        if (!val){
          input.setAttribute("aria-invalid","true");
          input.style.borderColor = "#ef4444";
          if (!first) first = input;
        } else {
          input.removeAttribute("aria-invalid");
          input.style.borderColor = "var(--border)";
        }
      }
      if (first){ first.focus(); return false; }
      return true;
    }

    // ===== SUBMIT =====
    document.getElementById("customer-intake-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      clearStatus();

      // Honeypot
      if (document.getElementById("company").value.trim() !== ""){
        setStatus("Submission blocked (spam detected).", false);
        return;
      }

      // Required
      if (!validateRequired(["siteName","location","fuelType"])){
        setStatus("Please complete all required fields.", false);
        return;
      }

      const submitBtn = document.getElementById("submitBtn");
      submitBtn.disabled = true;
      submitBtn.textContent = "Submitting…";

      const payload = {
        siteName: document.getElementById("siteName").value.trim(),
        location: document.getElementById("location").value.trim(),
        contractTermYears: sanitizeTBC(document.getElementById("contractTermYears").value),
        fuelType: document.getElementById("fuelType").value.trim(),
        fuelPrice: sanitizeTBC(document.getElementById("fuelPrice").value),
        landAvailability: document.getElementById("landAvailability").value.trim() || "TBC",
        maxTemperatureC: sanitizeTBC(document.getElementById("maxTemperatureC").value),
        contactName: document.getElementById("contactName").value.trim(),
        contactEmail: document.getElementById("contactEmail").value.trim(),
        notes: document.getElementById("notes").value.trim()
      };

      try{
        const headers = { "Content-Type": "application/json" };
        if (SHARED_FORM_TOKEN) headers["X-Form-Token"] = SHARED_FORM_TOKEN;

        const res = await fetch(FLOW_URL, {
          method: "POST",
          headers,
          body: JSON.stringify(payload)
        });

        let data, text;
        try { data = await res.json(); } catch { text = await res.text(); }

        if (!res.ok){
          const msg = (data && (data.message || data.error || JSON.stringify(data))) || text || ("HTTP " + res.status);
          throw new Error(msg);
        }

        const okMsg = (data && (data.message || data.status || "Submitted successfully.")) || "Submitted successfully.";
        setStatus(okMsg, true);
        e.target.reset();
      } catch(err){
        setStatus("Submission failed: " + (err?.message || String(err)), false);
        console.error(err);
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "Submit";
      }
    });
  </script>
</body>
</html>
